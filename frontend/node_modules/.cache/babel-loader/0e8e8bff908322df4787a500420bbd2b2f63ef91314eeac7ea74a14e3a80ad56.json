{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import axios from'axios';import toast from'react-hot-toast';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};// Configure axios defaults - dynamically determine backend URL\nconst getBackendURL=()=>{// If we have an explicit backend URL from env, use it\nif(process.env.REACT_APP_BACKEND_URL&&process.env.REACT_APP_BACKEND_URL!=='http://localhost:8001'){return process.env.REACT_APP_BACKEND_URL;}// If we're running in production (not localhost), use relative URL\nif(window.location.hostname!=='localhost'&&window.location.hostname!=='127.0.0.1'){// Use the same domain as frontend but with API prefix\nreturn\"\".concat(window.location.protocol,\"//\").concat(window.location.host);}// Default to localhost for development\nreturn'http://localhost:8001';};const API_URL=getBackendURL();console.log('🔗 Backend URL configured:',API_URL);axios.defaults.baseURL=API_URL;export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[token,setToken]=useState(localStorage.getItem('token'));// Set up axios interceptor for token\nuseEffect(()=>{if(token){axios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);}else{delete axios.defaults.headers.common['Authorization'];}},[token]);// Check if user is authenticated on app load\nuseEffect(()=>{const checkAuth=async()=>{const savedToken=localStorage.getItem('token');if(savedToken){try{const response=await axios.get('/api/auth/me');setUser(response.data);setToken(savedToken);}catch(error){// Token is invalid, remove it\nlocalStorage.removeItem('token');setToken(null);setUser(null);}}setLoading(false);};checkAuth();},[]);const login=async credentials=>{try{setLoading(true);console.log('🔑 Attempting login with:',credentials.email);console.log('🌐 Backend URL:',API_URL);const formData=new FormData();formData.append('username',credentials.email);formData.append('password',credentials.password);console.log('📤 Making login request to:',\"\".concat(API_URL,\"/api/auth/login\"));const response=await axios.post('/api/auth/login',formData,{headers:{'Content-Type':'multipart/form-data'}});console.log('📥 Login response received:',response.status);const{access_token,user:userData}=response.data;localStorage.setItem('token',access_token);setToken(access_token);setUser(userData);console.log('✅ Login successful for:',userData.full_name);toast.success(\"Welcome back, \".concat(userData.full_name,\"!\"));return{success:true};}catch(error){var _error$response,_error$config,_error$response2,_error$response2$data;console.error('❌ Login error:',error);console.error('📋 Error response:',(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);console.error('🔗 Request URL:',(_error$config=error.config)===null||_error$config===void 0?void 0:_error$config.url);const message=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.detail)||'Login failed';toast.error(message);return{success:false,error:message};}finally{setLoading(false);}};const register=async userData=>{try{setLoading(true);const response=await axios.post('/api/auth/register',userData);const{access_token,user:newUser}=response.data;localStorage.setItem('token',access_token);setToken(access_token);setUser(newUser);toast.success(\"Welcome to ProjectHub, \".concat(newUser.full_name,\"!\"));return{success:true};}catch(error){var _error$response3,_error$response3$data;const message=((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.detail)||'Registration failed';toast.error(message);return{success:false,error:message};}finally{setLoading(false);}};const logout=()=>{localStorage.removeItem('token');setToken(null);setUser(null);delete axios.defaults.headers.common['Authorization'];toast.success('Logged out successfully');};const value={user,token,loading,login,register,logout};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","toast","jsx","_jsx","AuthContext","useAuth","context","Error","getBackendURL","process","env","REACT_APP_BACKEND_URL","window","location","hostname","concat","protocol","host","API_URL","console","log","defaults","baseURL","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","setToken","localStorage","getItem","headers","common","checkAuth","savedToken","response","get","data","error","removeItem","login","credentials","email","formData","FormData","append","password","post","status","access_token","userData","setItem","full_name","success","_error$response","_error$config","_error$response2","_error$response2$data","config","url","message","detail","register","newUser","_error$response3","_error$response3$data","logout","value","Provider"],"sources":["/app/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport axios from 'axios';\nimport toast from 'react-hot-toast';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\n// Configure axios defaults - dynamically determine backend URL\nconst getBackendURL = () => {\n  // If we have an explicit backend URL from env, use it\n  if (process.env.REACT_APP_BACKEND_URL && process.env.REACT_APP_BACKEND_URL !== 'http://localhost:8001') {\n    return process.env.REACT_APP_BACKEND_URL;\n  }\n  \n  // If we're running in production (not localhost), use relative URL\n  if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {\n    // Use the same domain as frontend but with API prefix\n    return `${window.location.protocol}//${window.location.host}`;\n  }\n  \n  // Default to localhost for development\n  return 'http://localhost:8001';\n};\n\nconst API_URL = getBackendURL();\nconsole.log('🔗 Backend URL configured:', API_URL);\naxios.defaults.baseURL = API_URL;\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [token, setToken] = useState(localStorage.getItem('token'));\n\n  // Set up axios interceptor for token\n  useEffect(() => {\n    if (token) {\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n    } else {\n      delete axios.defaults.headers.common['Authorization'];\n    }\n  }, [token]);\n\n  // Check if user is authenticated on app load\n  useEffect(() => {\n    const checkAuth = async () => {\n      const savedToken = localStorage.getItem('token');\n      if (savedToken) {\n        try {\n          const response = await axios.get('/api/auth/me');\n          setUser(response.data);\n          setToken(savedToken);\n        } catch (error) {\n          // Token is invalid, remove it\n          localStorage.removeItem('token');\n          setToken(null);\n          setUser(null);\n        }\n      }\n      setLoading(false);\n    };\n\n    checkAuth();\n  }, []);\n\n  const login = async (credentials) => {\n    try {\n      setLoading(true);\n      console.log('🔑 Attempting login with:', credentials.email);\n      console.log('🌐 Backend URL:', API_URL);\n      \n      const formData = new FormData();\n      formData.append('username', credentials.email);\n      formData.append('password', credentials.password);\n\n      console.log('📤 Making login request to:', `${API_URL}/api/auth/login`);\n      \n      const response = await axios.post('/api/auth/login', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n\n      console.log('📥 Login response received:', response.status);\n      \n      const { access_token, user: userData } = response.data;\n      \n      localStorage.setItem('token', access_token);\n      setToken(access_token);\n      setUser(userData);\n      \n      console.log('✅ Login successful for:', userData.full_name);\n      toast.success(`Welcome back, ${userData.full_name}!`);\n      return { success: true };\n    } catch (error) {\n      console.error('❌ Login error:', error);\n      console.error('📋 Error response:', error.response?.data);\n      console.error('🔗 Request URL:', error.config?.url);\n      \n      const message = error.response?.data?.detail || 'Login failed';\n      toast.error(message);\n      return { success: false, error: message };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const register = async (userData) => {\n    try {\n      setLoading(true);\n      const response = await axios.post('/api/auth/register', userData);\n      \n      const { access_token, user: newUser } = response.data;\n      \n      localStorage.setItem('token', access_token);\n      setToken(access_token);\n      setUser(newUser);\n      \n      toast.success(`Welcome to ProjectHub, ${newUser.full_name}!`);\n      return { success: true };\n    } catch (error) {\n      const message = error.response?.data?.detail || 'Registration failed';\n      toast.error(message);\n      return { success: false, error: message };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    setToken(null);\n    setUser(null);\n    delete axios.defaults.headers.common['Authorization'];\n    toast.success('Logged out successfully');\n  };\n\n  const value = {\n    user,\n    token,\n    loading,\n    login,\n    register,\n    logout,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}